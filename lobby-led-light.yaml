esphome:
  name: lobby-led-light
  platform: ESP32
  board: esp32doit-devkit-v1
  on_boot:
    priority: 300.0
    then:
      - light.turn_on:
          id: lobbyledlight
          brightness: 1%
          red: 28%
          green: 82%
          blue: 100%
          effect: "Fade in"
      - delay: 10s
      - light.turn_on:
          id: lobbyledlight
          brightness: 80%
          red: 28%
          green: 82%
          blue: 100%
          effect: "Flicker"

globals:
  - id: target_brightness
    type: float
    restore_value: no
    initial_value: '.8'
  - id: brightness_step
    type: float
    restore_value: no
    initial_value: '.05'

# Enable logging
logger:

# Enable Home Assistant API
api:

ota:
  password: "8ff11faff19373c6b5a20dd90525edcf"

wifi:
  ssid: "RT-N56U_2.4G"
  password: "GoesUpInSky"

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "Lobby-Led-Light Fallback Hotspot"
    password: "OUHtZnl5EiUP"

captive_portal:

light:
  - platform: fastled_clockless
    id: lobbyledlight
    chipset: WS2812B
    pin: GPIO13
    num_leds: 8
    rgb_order: GRB
    name: "Lobby Led Light"
    restore_mode: RESTORE_DEFAULT_OFF
    effects:
      - lambda:
          name: "Fade in"
          update_interval: 25ms
          lambda: |-
            float current_brightness = lobbyledlight->current_values.get_brightness();
            auto call = lobbyledlight->make_call();
            if (current_brightness <= target_brightness->value()) {
              current_brightness += brightness_step->value();
              call.set_brightness(current_brightness);
              call.set_transition_length(0);
              call.set_publish(false);
              call.set_save(false);
              call.perform();
            }
      - flicker:
          name: "Flicker"
          alpha: 80%
          intensity: 2.5%
